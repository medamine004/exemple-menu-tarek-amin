<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Caf√© / Th√© - Caf√© Andalous</title>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            background-color: #E9DDCF;
            color: #3d2c1b;
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        .logo-container { text-align: center; padding: 15px 20px 35px; }
        .logo-container img {
            width: 320px; max-width: 85vw; height: auto;
            border-radius: 50%; border: 4px solid #5F3C13;
            box-shadow: 0 6px 20px rgba(95,60,19,0.25);
        }

        .logo-subtitle {
            max-width: 820px; margin: 20px auto 0; padding: 0 20px;
            font-size: 1.1rem; font-weight: 300; line-height: 1.5;
            color: #5F3C13; text-align: center;
        }

        .category-title {
            text-align: center; font-family: 'Playfair Display', serif;
            font-size: 2.5rem; color: #5F3C13; margin: 35px 0 40px;
            position: relative;
        }
        .category-title::after {
            content: ''; display: block; width: 100px; height: 3px;
            background: linear-gradient(to right, transparent, #5F3C13, transparent);
            margin: 12px auto 0;
        }

        .hero-image-container {
            width: 100%; max-width: 800px; margin: 0 auto 45px;
            border-radius: 16px; overflow: hidden;
            border: 3px solid #5F3C13; box-shadow: 0 4px 14px rgba(95,60,19,0.2);
        }
        .hero-image { width: 100%; height: 160px; object-fit: cover; }

        .cafe-menu {
            max-width: 960px; margin: 0 auto 90px; padding: 0 16px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .cafe-item {
            background: linear-gradient(145deg, #ffffff, #f5efe3);
            border-radius: 16px; padding: 14px; display: flex;
            align-items: center; gap: 14px;
            box-shadow: 0 4px 12px rgba(95,60,19,0.13);
            animation: fadeInUp 0.7s ease forwards; opacity: 0;
        }
        .cafe-item:nth-child(odd)  { animation-delay: 0.1s; }
        .cafe-item:nth-child(even) { animation-delay: 0.25s; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .cafe-item-img {
            width: 70px; height: 70px; border-radius: 50%;
            object-fit: cover; border: 3px solid #5F3C13; flex-shrink: 0;
        }

        .cafe-details { flex: 1; }
        .cafe-name { font-family: 'Playfair Display', serif; font-size: 1.35rem; font-weight: 700; color: #3d2c1b; }
        .cafe-price { font-size: 1.55rem; font-weight: 800; color: #5F3C13; margin: 3px 0; }

        .quantity-controls { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
        .quantity-controls button {
            width: 34px; height: 34px; border: none; border-radius: 50%;
            background: #5F3C13; color: white; font-size: 1.35rem; font-weight: bold;
            cursor: pointer; transition: transform 0.15s;
        }
        .quantity-controls button:active { transform: scale(0.92); }
        .quantity-controls span { min-width: 30px; text-align: center; font-weight: bold; font-size: 1.25rem; }

        #cart-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #f8f1e7; border-top: 3px solid #5F3C13;
            padding: 12px 16px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 -4px 14px rgba(0,0,0,0.18);
            z-index: 1000; flex-wrap: wrap; gap: 10px;
        }
        #cart-total { font-size: 1.25rem; font-weight: bold; color: #3d2c1b; }
        #table-input { width: 80px; padding: 8px; text-align: center; border: 2px solid #5F3C13; border-radius: 8px; font-size: 1.1rem; }
        #order-btn {
            background: linear-gradient(90deg, #5F3C13, #7a5123);
            color: white; border: none; padding: 10px 28px;
            border-radius: 50px; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; transition: all 0.25s;
        }
        #order-btn:hover { background: linear-gradient(90deg, #4a2f0f, #5F3C13); transform: translateY(-2px); }
        #order-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(61,44,27,0.65);
            backdrop-filter: blur(6px);
            display: none; align-items: center; justify-content: center;
            z-index: 2000;
        }

        .confirmation-modal {
            background: white;
            border-radius: 16px;
            width: 90%; max-width: 420px;
            padding: 32px 24px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.35);
            transform: scale(0.8); opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .confirmation-modal.show {
            transform: scale(1); opacity: 1;
        }

        .check-circle {
            font-size: 4.5rem;
            color: #2e7d32;
            margin-bottom: 20px;
            animation: checkAnim 1.2s ease-in-out;
        }

        @keyframes checkAnim {
            0%   { transform: scale(0.4) rotate(-180deg); opacity: 0; }
            60%  { transform: scale(1.15); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: #3d2c1b;
            margin-bottom: 12px;
        }

        .modal-message {
            font-size: 1.05rem;
            color: #5f3c13;
            line-height: 1.5;
            margin-bottom: 24px;
        }

        .modal-table-info {
            font-weight: 500;
            color: #7a5123;
            margin-bottom: 20px;
        }

        .close-btn {
            background: #5F3C13;
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 50px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
        }

        .close-btn:hover {
            background: #7a5123;
            transform: translateY(-2px);
        }

        .site-footer {
            background-color: #3d2c1b;
            color: #fdfaf5;
            padding: 80px 20px 60px;
            text-align: center;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 35px;
        }

        .footer-text {
            font-size: 1.4rem;
            font-weight: 300;
            line-height: 1.6;
        }

        .footer-text span {
            font-size: 1.1rem;
            opacity: 0.9;
            display: block;
            margin-top: 12px;
        }

        .footer-phone {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            font-size: 1.6rem;
        }

        .footer-phone i {
            font-size: 2rem;
            color: #5F3C13;
            margin-bottom: 10px;
        }

        .footer-phone strong {
            color: #5F3C13;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 40px;
        }

        .social-links a {
            color: #fdfaf5;
            font-size: 2.8rem;
            transition: all 0.4s ease;
        }

        .social-links a:hover {
            color: #5F3C13;
            transform: scale(1.2);
        }

        .copyright {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 20px;
            font-weight: 500;
        }

        .back-button-container {
            text-align: center;
            margin: 50px 0 80px;
        }

        .back-button {
            background: linear-gradient(to right, #5F3C13, #7a5123);
            color: white;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 1.25rem;
            font-weight: 700;
            text-decoration: none;
            box-shadow: 0 8px 20px rgba(95,60,19,0.3);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        @media (max-width: 520px) {
            .confirmation-modal { padding: 28px 20px; }
            .check-circle { font-size: 3.8rem; }
            .modal-title { font-size: 1.6rem; }
        }

        @media (max-width: 480px) {
            .logo-container img { width: 180px; }
            .category-title { font-size: 2.1rem; margin: 15px 0 35px; }
            .hero-image { height: 110px; }
            .cafe-menu { grid-template-columns: 1fr; gap: 16px; padding: 0 10px; }
            .cafe-item { padding: 12px; gap: 12px; }
            .cafe-item-img { width: 60px; height: 60px; }
            .cafe-name { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <div class="logo-container">
        <img src="image/andalons.png" alt="Caf√© Andalous">
        <p class="logo-subtitle">
            Bienvenue chez Andalous, votre refuge cosy o√π les ar√¥mes authentiques du caf√© et du th√© se m√™lent √† une ambiance chaleureuse et conviviale.
        </p>
    </div>

    <h1 class="category-title">Caf√© / Th√©</h1>

    <div class="hero-image-container">
        <img src="image/cafe et the.jpg" alt="Caf√© et Th√©" class="hero-image">
    </div>

    <div class="cafe-menu" id="menu-container">
        <div class="loading" style="text-align:center; padding:40px; color:#5F3C13;">
            Chargement du menu...
        </div>
    </div>

    <div class="back-button-container">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Retour au Menu
        </a>
    </div>

    <!-- Barre panier fixe -->
    <div id="cart-bar">
        <span id="cart-total">Total : 0 DT</span>
        <input type="number" id="table-input" placeholder="Table" min="1">
        <button id="order-btn">Commander via WhatsApp</button>
    </div>

    <!-- Modal de confirmation -->
    <div class="modal-overlay" id="confirmModal">
        <div class="confirmation-modal" id="modalContent">
            <i class="fas fa-check-circle check-circle"></i>
            <h3 class="modal-title">Commande envoy√©e avec succ√®s !</h3>
            <p class="modal-message">Merci pour votre commande.<br>Nous la pr√©parons imm√©diatement.</p>
            <p class="modal-table-info" id="modalTableInfo"></p>
            <button class="close-btn" id="closeModalBtn">Fermer</button>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-text">
                Merci pour votre fid√©lit√©<br>
                <span>Une exp√©rience unique alliant saveurs authentiques et ambiance chaleureuse</span>
            </div>
            <div class="footer-phone">
                <i class="fas fa-phone-alt"></i>
                <div><strong>56615128</strong></div>
            </div>
            <div class="social-links">
                <a href="https://www.facebook.com/profile.php?id=100063944715824" target="_blank" aria-label="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://www.instagram.com/cafe__andalous/" target="_blank" aria-label="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
            <div class="copyright">
                ¬© Caf√© Andalous Mus√©e du Bardo
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuContainer = document.getElementById('menu-container');
            const totalDisplay  = document.getElementById('cart-total');
            const tableInput    = document.getElementById('table-input');
            const orderBtn      = document.getElementById('order-btn');
            const modal         = document.getElementById('confirmModal');
            const modalContent  = document.getElementById('modalContent');
            const closeBtn      = document.getElementById('closeModalBtn');
            const modalTable    = document.getElementById('modalTableInfo');

            // Nouvelle URL CSV fournie
            const sheetCsvUrl = 'https://docs.google.com/spreadsheets/d/11mtz2P0uvdS-Tm_f6Zs8aLS4VZpHXKJaFcIS9H-AYvg/gviz/tq?tqx=out:csv';

            const lang = 'fr'; // Pour futur multi-langue

            function parseCSV(csvText) {
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                const data = [];

                for (let i = 1; i < lines.length; i++) {
                    if (!lines[i].trim()) continue;
                    // Gestion basique des virgules dans les champs (approximation)
                    let row = [];
                    let current = '';
                    let inQuotes = false;

                    for (let char of lines[i] + ',') {
                        if (char === '"' && !inQuotes) {
                            inQuotes = true;
                        } else if (char === '"' && inQuotes) {
                            inQuotes = false;
                        } else if (char === ',' && !inQuotes) {
                            row.push(current.trim().replace(/^"|"$/g, ''));
                            current = '';
                        } else {
                            current += char;
                        }
                    }

                    if (row.length !== headers.length) continue;

                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = row[index] || '';
                    });
                    data.push(obj);
                }
                return data;
            }

            fetch(sheetCsvUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
                    return response.text();
                })
                .then(csvText => {
                    const data = parseCSV(csvText);

                    const availableItems = data.filter(item => 
                        (item.available || '').toLowerCase() !== 'no' &&
                        item.available !== ''
                    );

                    const groups = {};
                    availableItems.forEach(item => {
                        const cat = (item.category || 'Autres').trim();
                        if (!groups[cat]) groups[cat] = [];
                        groups[cat].push(item);
                    });

                    menuContainer.innerHTML = '';

                    Object.keys(groups).sort().forEach(category => {
                        const title = document.createElement('h2');
                        title.className = 'category-title';
                        title.textContent = category;
                        menuContainer.appendChild(title);

                        groups[category].forEach(item => {
                            const price = parseFloat(item.price?.replace(/[^0-9.,]/g, '').replace(',', '.')) || 0;

                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'cafe-item';
                            itemDiv.dataset.price = price;

                            const img = document.createElement('img');
                            img.className = 'cafe-item-img';
                            img.alt = item[`name_${lang}`] || item.name_fr || item.name || 'Produit';
                            img.src = item.image 
                                ? `image/${item.image.trim()}` 
                                : 'image/placeholder.png';
                            itemDiv.appendChild(img);

                            const details = document.createElement('div');
                            details.className = 'cafe-details';

                            const name = document.createElement('div');
                            name.className = 'cafe-name';
                            name.textContent = item[`name_${lang}`] || item.name_fr || item.name || 'Nom manquant';
                            details.appendChild(name);

                            const priceEl = document.createElement('div');
                            priceEl.className = 'cafe-price';
                            priceEl.textContent = `${price} DT`;
                            details.appendChild(priceEl);

                            const controls = document.createElement('div');
                            controls.className = 'quantity-controls';
                            controls.innerHTML = `
                                <button class="minus">-</button>
                                <span class="qty">0</span>
                                <button class="plus">+</button>
                            `;
                            details.appendChild(controls);

                            itemDiv.appendChild(details);
                            menuContainer.appendChild(itemDiv);
                        });
                    });

                    initializeCart();
                })
                .catch(err => {
                    console.error('Erreur chargement menu:', err);
                    menuContainer.innerHTML = `
                        <p style="text-align:center; color:red; padding:40px; font-size:1.2rem;">
                            Impossible de charger le menu actuellement.<br>
                            V√©rifiez votre connexion ou r√©essayez plus tard.
                        </p>
                    `;
                });

            function initializeCart() {
                const items = document.querySelectorAll('.cafe-item');

                function updateTotal() {
                    let total = 0;
                    items.forEach(item => {
                        const qty = Number(item.querySelector('.qty').textContent);
                        const price = Number(item.dataset.price);
                        total += qty * price;
                    });
                    totalDisplay.textContent = `Total : ${total} DT`;
                }

                items.forEach(item => {
                    const minus   = item.querySelector('.minus');
                    const plus    = item.querySelector('.plus');
                    const qtySpan = item.querySelector('.qty');

                    minus.addEventListener('click', () => {
                        let qty = Number(qtySpan.textContent);
                        if (qty > 0) {
                            qtySpan.textContent = qty - 1;
                            updateTotal();
                        }
                    });

                    plus.addEventListener('click', () => {
                        let qty = Number(qtySpan.textContent);
                        qtySpan.textContent = qty + 1;
                        updateTotal();
                    });
                });

                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                    orderBtn.disabled = false;
                });

                orderBtn.addEventListener('click', () => {
                    if (orderBtn.disabled) return;
                    orderBtn.disabled = true;

                    const table = tableInput.value.trim();
                    if (!table) {
                        alert("Veuillez indiquer le num√©ro de votre table !");
                        orderBtn.disabled = false;
                        return;
                    }

                    const orderLines = [];
                    let grandTotal = 0;

                    items.forEach(item => {
                        const qty = Number(item.querySelector('.qty').textContent);
                        if (qty > 0) {
                            const name = item.querySelector('.cafe-name').textContent.trim();
                            const price = Number(item.dataset.price);
                            const subtotal = qty * price;
                            orderLines.push(`‚Ä¢ ${name} √ó ${qty}    ${subtotal} DT`);
                            grandTotal += subtotal;
                        }
                    });

                    if (orderLines.length === 0) {
                        alert("Votre panier est vide !");
                        orderBtn.disabled = false;
                        return;
                    }

                    const now = new Date();
                    const heure = now.toLocaleTimeString('fr-TN', {hour: '2-digit', minute: '2-digit'});

                    const message = 
`üìã NOUVELLE COMMANDE - Caf√© Andalous
Table : ${table}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${orderLines.join('\n')}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üí∞ Total : ${grandTotal} DT
üïí Heure : ${heure}`;

                    const phone = "21656615128";
                    const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;

                    modalTable.textContent = `Table : ${table} ‚Ä¢ Total : ${grandTotal} DT`;
                    modal.style.display = 'flex';
                    setTimeout(() => modalContent.classList.add('show'), 50);

                    setTimeout(() => {
                        modalContent.classList.remove('show');
                        setTimeout(() => {
                            modal.style.display = 'none';
                            orderBtn.disabled = false;
                        }, 400);
                    }, 5000);

                    setTimeout(() => {
                        items.forEach(item => item.querySelector('.qty').textContent = '0');
                        updateTotal();
                        tableInput.value = '';
                    }, 600);

                    window.open(whatsappUrl, '_blank');
                });
            }
        });
    </script>
</body>
</html>